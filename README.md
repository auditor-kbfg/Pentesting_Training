CHM Pentesting Tool  
2024.03.05  
Mady By JongChanPark @KBBank in KBFG  

CHM 악성코드 점검 툴  
1. 배경
  북한의 해킹그룹 Kimsuky에서 CHM을 이용하여 공격을 하는 것을 보고 만듬  
  참고: https://stic.secui.com/main/main/threatInfo?id=209

2. 점검 항목  
   **파일 다운로드 없이 바로 실행시킬 수 있는 방법에 대해 점검합니다**  
   **아래 방식은 원격지에서 메모리에 저장한 뒤 즉시 파일 실행 합니다**  
   rundll32, runsvr32, powershell -c, msiexec, xsl, mshta

   **아래의 경우 해커가 업로드를 위해 사용하는 명령어로 별도 점검을 합니다**  
   Bitmap

3. 필수 툴  
   Python (웹서버 용도)  

4. 사용방법:  
  3.1. 웹서버 실행  
   python -m http.server  
  3.2. /web 폴더를 파이썬 웹서버에 옮김  
  3.3  http://127.0.0.1:8000/web 접근하여 파일 제대로 옮겨짐을 확인  
  3.4 Project.chm 파일 실행하여 버튼 클릭 후 실행되는 것을 확인  
    **현재 서버 접근은 127.0.0.1:8000/web 으로 설정되어 있으며 변경을 원할 시 src폴더내 변경 필수**  

5. 조치방안  
   EDR 솔루션(ex.지니안)에서 처리가 가능합니다.   

CHM Malware Check Tool  
1. Background  
  Developed after observing North Korea's hacking group Kimsuky utilizing CHM files for attacks.  
  Reference: https://stic.secui.com/main/main/threatInfo?id=209  

2. Inspection Items  
  **Checks for methods allowing immediate execution without file download.**  
  **The following methods execute files directly from memory, without downloading:**  
  rundll32, runsvr32, powershell -c, msiexec, xsl, mshta  

  **Separate inspection for commands used by hackers for uploads:**  
  Bitmap  

3. Essential Tools  
  Python (for web server)  

4. Instructions:  
  4.1. Start the web server:  
  python -m http.server  
  4.2. Move the /web folder to the Python web server.  
  4.3. Access http://127.0.0.1:8000/web to verify that files are correctly transferred.  
  4.4. Execute the Project.chm file and verify execution upon button click.  

5. Countermeasures  
  EDR solutions (e.g., Genian) can handle this issue.  



**주소 변경하는법**  
  1. htmlhelp.exe 프로그램 설치  
  2. src\PyWin32\PyWin32.HTML파일 내 주소 변경(http://127.0.0.1/web)  
  3. html help workshop 실행  
  4. File -> Open -> \src\PyWin32\Project.hhp 열기  
  5. File -> Compile -> 컴파일 후 Project.chm 사용  
